# InfluxDB 3 Core Configuration File
#
# This file contains all available configuration options for InfluxDB 3
# Core server. All options are commented out by default.
# Uncomment and set values as needed for your deployment.
#
# Configuration precedence:
# - CLI flags > environment variables > config file > defaults
#
# For more information, see:
# https://docs.influxdata.com/influxdb3/core/

# =============================================================================
# Required Configuration
# =============================================================================

# Node identifier used as prefix in object store file paths
# Default (quick-start mode): {hostname}-node or primary-node if hostname
# unavailable (env: INFLUXDB3_NODE_IDENTIFIER_PREFIX)
#node-id="<NODE_ID>"

# Obtain the node id from the specified environment variable; conflicts with
# --node-id flag (env: INFLUXDB3_NODE_IDENTIFIER_FROM_ENV)
#node-id-from-env="<VARNAME>"

# Object storage to use (Required)
# Possible values: memory, memory-throttled, file, s3, google, azure
# (env: INFLUXDB3_OBJECT_STORE)
#object-store="<STORE>"

# =============================================================================
# Common Options
# =============================================================================

# Address for HTTP API requests
# Default: 0.0.0.0:8181 (env: INFLUXDB3_HTTP_BIND_ADDR)
#http-bind="0.0.0.0:8181"

# Logs: filter directive
# Default: info,iox_query::query_log=warn,influxdb3_query_executor::core=warn
# (env: LOG_FILTER)
#log-filter="info,iox_query::query_log=warn,influxdb3_query_executor::core=warn"

# =============================================================================
# Security
# =============================================================================

# The path to the key file for TLS to be enabled (env: INFLUXDB3_TLS_KEY)
#tls-key="<KEY_FILE>"

# The path to the cert file for TLS to be enabled (env: INFLUXDB3_TLS_CERT)
#tls-cert="<CERT_FILE>"

# The minimum version for TLS (tls-1.2 or tls-1.3)
# Default: tls-1.2 (env: INFLUXDB3_TLS_MINIMUM_VERSION)
#tls-minimum-version="tls-1.2"

# Enable admin token recovery endpoint
# WARNING: This endpoint allows unauthenticated admin token regeneration!
# Default address: 127.0.0.1:8182 (env: INFLUXDB3_ADMIN_TOKEN_RECOVERY_HTTP_BIND_ADDR)
#admin-token-recovery-http-bind="127.0.0.1:8182"

# File containing offline admin tokens. The token will be loaded at server
# startup if no admin token exists. Generate using:
#  $ influxdb3 create token --admin --offline
# (env: INFLUXDB3_ADMIN_TOKEN_FILE)
#admin-token-file="<FILE>"

# Disables authentication for all server actions (CLI commands and API
# requests). The server processes all requests without requiring tokens or
# authentication. (env: INFLUXDB3_START_WITHOUT_AUTH)
#without-auth="<BOOL>"

# Optionally disable authz by passing in a comma separated list of resources.
# Valid values are health, ping, and metrics. (env: INFLUXDB3_DISABLE_AUTHZ)
#disable-authz="<RESOURCES>"

# =============================================================================
# Resource Limits
# =============================================================================

# Size of the query log
# Default: 1000 (env: INFLUXDB3_QUERY_LOG_SIZE)
#query-log-size="1000"

# Max parquet files allowed in a query (env: INFLUXDB3_QUERY_FILE_LIMIT)
#query-file-limit="<LIMIT>"

# =============================================================================
# Object Storage
# =============================================================================

# Location to store files locally. Required when using the file object store
# (default object store type)
# Default (quick-start mode; env: INFLUXDB3_DB_DIR)
#data-dir="<DIR>"

# Bucket name for cloud object storage
# Required when using cloud storage (AWS S3, Azure Blob, Google Cloud; env: INFLUXDB3_BUCKET)
#bucket="<BUCKET>"

# -----------------------------------------------------------------------------
# AWS S3
# -----------------------------------------------------------------------------

# S3 access key ID
# Default: "" (empty - uses AWS credential chain if not specified; env: AWS_ACCESS_KEY_ID)
#aws-access-key-id="<KEY>"

# S3 secret access key
# Default: "" (empty - uses AWS credential chain if not specified; env: AWS_SECRET_ACCESS_KEY)
#aws-secret-access-key="<KEY>"

# S3 region
# Default: us-east-1 (env: AWS_DEFAULT_REGION)
#aws-default-region="us-east-1"

# S3 compatibility endpoint (env: AWS_ENDPOINT)
#aws-endpoint="<ENDPOINT>"

# S3 session token for federated login/SSO (env: AWS_SESSION_TOKEN)
#aws-session-token="<TOKEN>"

# Allow unencrypted HTTP to AWS (env: AWS_ALLOW_HTTP)
#aws-allow-http="false"

# Skip request signing (env: AWS_SKIP_SIGNATURE)
#aws-skip-signature="false"

# S3 credentials file to use instead of aws-access-key-id, aws-secret-access-key,
# etc; should be JSON-formatted and contain the following (aws_session_token
# and expiry are optional):
#  {
#    "aws_access_key_id": "AWS_ACCESS_KEY_ID",
#    "aws_secret_access_key": "AWS_SECRET_ACCESS_KEY",
#    "aws_session_token": "AWS_SESSION_TOKEN",
#    "expiry": "UNIX_SECONDS_TIMESTAMP"
#  }
# Default: "" (empty; env: AWS_CREDENTIALS_FILE)
#aws-credentials-file="<PATH>"

# -----------------------------------------------------------------------------
# Azure Blob Storage
# -----------------------------------------------------------------------------

# Azure storage account name (env: AZURE_STORAGE_ACCOUNT)
#azure-storage-account="<ACCT>"

# Azure storage access key (env: AZURE_STORAGE_ACCESS_KEY)
#azure-storage-access-key="<KEY>"

# Azure blob storage endpoint (env: AZURE_ENDPOINT)
#azure-endpoint="<ENDPOINT>"

# Allow unencrypted HTTP to Azure (env: AZURE_ALLOW_HTTP)
#azure-allow-http="false"

# -----------------------------------------------------------------------------
# Google Cloud Storage
# -----------------------------------------------------------------------------

# Path to Google credentials JSON (env: GOOGLE_SERVICE_ACCOUNT)
#google-service-account="<PATH>"

# -----------------------------------------------------------------------------
# Object Store Performance & Connection
# -----------------------------------------------------------------------------

# Connection limit for network object stores
# Default: 16 (env: OBJECT_STORE_CONNECTION_LIMIT)
#object-store-connection-limit="16"

# HTTP request timeout for object store operations
# Default: 30s (env: OBJECT_STORE_REQUEST_TIMEOUT)
#object-store-request-timeout="30s"

# Force HTTP/2 for object stores (env: OBJECT_STORE_HTTP2_ONLY)
#object-store-http2-only="false"

# HTTP/2 max frame size (env: OBJECT_STORE_HTTP2_MAX_FRAME_SIZE)
#object-store-http2-max-frame-size="<SIZE>"

# Max request retry attempts
# Default: 10 (env: OBJECT_STORE_MAX_RETRIES)
#object-store-max-retries="<N>"

# Max retry timeout
# Default: 180s (env: OBJECT_STORE_RETRY_TIMEOUT)
#object-store-retry-timeout="<TIMEOUT>"

# S3 compatible cache endpoint (env: OBJECT_STORE_CACHE_ENDPOINT)
#object-store-cache-endpoint="<ENDPOINT>"

# Skip TLS certificate verification for object storage (env: OBJECT_STORE_TLS_ALLOW_INSECURE)
#object-store-tls-allow-insecure="false"

# Path to custom CA certificate file (PEM format) for object storage
# Use when your object store uses a certificate signed by a private CA
# (env: OBJECT_STORE_TLS_CA)
#object-store-tls-ca="<PATH>"

# =============================================================================
# Processing Engine
# =============================================================================

# Location of plugins (env: INFLUXDB3_PLUGIN_DIR)
#plugin-dir="<DIR>"

# Location of your virtual environment
# Default: <plugin-dir>/venv (auto-created when 'plugin-dir' is set)
# Note: If using another virtual environment, it must use the bundled Python
# interpreter shipped with InfluxDB (env: VIRTUAL_ENV)
#virtual-env-location="<PATH>"

# Package manager for Processing Engine. Possible values: discover, pip, uv,
# disabled
# Default: discover (env: INFLUXDB3_PACKAGE_MANAGER)
#package-manager="discover"

# URL of plugin repository (env: INFLUXDB3_PLUGIN_REPO)
#plugin-repo="<URL>"

# =============================================================================
# Data Lifecycle & Retention
# =============================================================================

# Duration for Parquet file arrangement
# Default: 10m (env: INFLUXDB3_GEN1_DURATION)
#gen1-duration="10m"

# The amount of time that the server looks back on startup when populating the
# in-memory index of gen1 files (env: INFLUXDB3_GEN1_LOOKBACK_DURATION)
#gen1-lookback-duration="<DURATION>"

# Grace period for hard deleted databases and tables before they are removed
# permanently from the catalog
# Default: 24h (env: INFLUXDB3_DELETE_GRACE_PERIOD)
#delete-grace-period="24h"

# The interval at which retention policies are checked and enforced
# Default: 30m (env: INFLUXDB3_RETENTION_CHECK_INTERVAL)
#retention-check-interval="30m"

# The default duration from when a database or table is soft-deleted until the
# data is scheduled to be hard deleted
# Default: 72h (env: INFLUXDB3_HARD_DELETE_DEFAULT_DURATION)
#hard-delete-default-duration="72h"

# =============================================================================
# Write-Ahead Log (WAL)
# =============================================================================

# Interval for flushing the WAL to object storage
# Default: 1s (env: INFLUXDB3_WAL_FLUSH_INTERVAL)
#wal-flush-interval="<INTERVAL>"

# Size threshold for WAL snapshot creation
# Default: 600 (env: INFLUXDB3_WAL_SNAPSHOT_SIZE)
#wal-snapshot-size="<SIZE>"

# Maximum size of the WAL write buffer
# Default: 100000 (env: INFLUXDB3_WAL_MAX_WRITE_BUFFER_SIZE)
#wal-max-write-buffer-size="<SIZE>"

# Concurrency limit for WAL replay operations
# Default: max(num_cpus, 10) - dynamically determined (env: INFLUXDB3_WAL_REPLAY_CONCURRENCY_LIMIT)
# Note: setting this too high can lead to OOM
#wal-replay-concurrency-limit="<N>"

# Fail server startup if WAL replay encounters errors
# Default: false (env: INFLUXDB3_WAL_REPLAY_FAIL_ON_ERROR)
#wal-replay-fail-on-error="false"

# Number of snapshotted WAL files to retain
# Default: 300 (env: INFLUXDB3_NUM_WAL_FILES_TO_KEEP)
#snapshotted-wal-files-to-keep="300"

# Interval for persisting snapshot checkpoints to object storage
# Checkpoints aggregate snapshot metadata for faster server startup
# Default: Disabled (env: INFLUXDB3_CHECKPOINT_INTERVAL)
#checkpoint-interval="<DURATION>"

# =============================================================================
# Last Value & Distinct Value Caches
# =============================================================================

# Last-N-Value cache eviction interval
# Default: 10s (env: INFLUXDB3_LAST_CACHE_EVICTION_INTERVAL)
#last-cache-eviction-interval="10s"

# Distinct Value cache eviction interval
# Default: 10s (env: INFLUXDB3_DISTINCT_CACHE_EVICTION_INTERVAL)
#distinct-cache-eviction-interval="10s"

# =============================================================================
# HTTP Configuration
# =============================================================================

# Maximum size of HTTP requests
# Default: 10485760 (10 MB) (env: INFLUXDB3_MAX_HTTP_REQUEST_SIZE)
#max-http-request-size="10485760"

# =============================================================================
# Memory Management
# =============================================================================

# Memory pool size for query execution
# Default: 20% (env: INFLUXDB3_EXEC_MEM_POOL_BYTES)
#exec-mem-pool-bytes="20%"

# Internal buffer threshold
# Default: 50% (env: INFLUXDB3_FORCE_SNAPSHOT_MEM_THRESHOLD)
#force-snapshot-mem-threshold="50%"

# In-memory Parquet cache size
# Default: 20% (env: INFLUXDB3_PARQUET_MEM_CACHE_SIZE)
#parquet-mem-cache-size="20%"

# Percentage to prune from cache
# Default: 0.1 (env: INFLUXDB3_PARQUET_MEM_CACHE_PRUNE_PERCENTAGE)
#parquet-mem-cache-prune-percentage="0.1"

# Cache prune check interval
# Default: 1s (env: INFLUXDB3_PARQUET_MEM_CACHE_PRUNE_INTERVAL)
#parquet-mem-cache-prune-interval="1s"

# Duration to check for query path caching
# Default: 5h (env: INFLUXDB3_PARQUET_MEM_CACHE_QUERY_PATH_DURATION)
#parquet-mem-cache-query-path-duration="5h"

# Disable in-memory Parquet cache
# (env: INFLUXDB3_DISABLE_PARQUET_MEM_CACHE)
#disable-parquet-mem-cache="false"

# Maximum number of table indices to cache in memory
# Set to 0 for unlimited cache size
# Default: 100 (env: INFLUXDB3_TABLE_INDEX_CACHE_MAX_ENTRIES)
#table-index-cache-max-entries="100"

# Maximum concurrent operations between table index cache and object store.
# This limits how many parallel requests can be made to object storage when
# loading or updating table indices
# Default: 20 (env: INFLUXDB3_TABLE_INDEX_CACHE_CONCURRENCY_LIMIT)
#table-index-cache-concurrency-limit="20"

# =============================================================================
# DataFusion Configuration
# =============================================================================

# Number of DataFusion runtime threads
# Default: Auto-determined based on available cores minus IO threads
# (env: INFLUXDB3_DATAFUSION_NUM_THREADS)
#num-datafusion-threads="<N>"

# Legacy alias for num-datafusion-threads (deprecated)
# (env: INFLUXDB3_DATAFUSION_NUM_THREADS)
#datafusion-num-threads="<N>"

# DataFusion runtime type. Possible values: current-thread, multi-thread,
# multi-thread-alt
# Default: multi-thread (env: INFLUXDB3_DATAFUSION_RUNTIME_TYPE)
#datafusion-runtime-type="multi-thread"

# Parquet file fanout limit
# Default: 1000 (env: INFLUXDB3_DATAFUSION_MAX_PARQUET_FANOUT)
#datafusion-max-parquet-fanout="1000"

# Use cached parquet loader (env: INFLUXDB3_DATAFUSION_USE_CACHED_PARQUET_LOADER)
#datafusion-use-cached-parquet-loader="false"

# Custom DataFusion configuration
# Default: "" (empty; env: INFLUXDB3_DATAFUSION_CONFIG)
#datafusion-config=""

# Disable LIFO slot. Possible values: true, false (env: INFLUXDB3_DATAFUSION_RUNTIME_DISABLE_LIFO_SLOT)
#datafusion-runtime-disable-lifo-slot="<BOOL>"

# Scheduler ticks for polling external events (env: INFLUXDB3_DATAFUSION_RUNTIME_EVENT_INTERVAL)
#datafusion-runtime-event-interval="<N>"

# Scheduler ticks for polling global task queue (env: INFLUXDB3_DATAFUSION_RUNTIME_GLOBAL_QUEUE_INTERVAL)
#datafusion-runtime-global-queue-interval="<N>"

# Thread limit for DataFusion runtime (env: INFLUXDB3_DATAFUSION_RUNTIME_MAX_BLOCKING_THREADS)
#datafusion-runtime-max-blocking-threads="<N>"

# Max events per tick (env: INFLUXDB3_DATAFUSION_RUNTIME_MAX_IO_EVENTS_PER_TICK)
#datafusion-runtime-max-io-events-per-tick="<N>"

# Blocking pool thread timeout (env: INFLUXDB3_DATAFUSION_RUNTIME_THREAD_KEEP_ALIVE)
#datafusion-runtime-thread-keep-alive="<DURATION>"

# Thread priority
# Default: 10 (env: INFLUXDB3_DATAFUSION_RUNTIME_THREAD_PRIORITY)
#datafusion-runtime-thread-priority="10"

# =============================================================================
# IO Runtime Configuration
# =============================================================================

# Number of IO runtime threads
# Default: Auto-determined (env: INFLUXDB3_IO_NUM_THREADS)
#num-io-threads="<N>"

# IO runtime type. Possible values: current-thread, multi-thread, multi-thread-alt
# Default: multi-thread (env: INFLUXDB3_IO_RUNTIME_TYPE)
#io-runtime-type="multi-thread"

# Disable LIFO slot for IO runtime (env: INFLUXDB3_IO_RUNTIME_DISABLE_LIFO_SLOT)
#io-runtime-disable-lifo-slot="false"

# IO runtime scheduler event interval (env: INFLUXDB3_IO_RUNTIME_EVENT_INTERVAL)
#io-runtime-event-interval="<N>"

# IO runtime global queue interval (env: INFLUXDB3_IO_RUNTIME_GLOBAL_QUEUE_INTERVAL)
#io-runtime-global-queue-interval="<N>"

# Max blocking threads for IO runtime (env: INFLUXDB3_IO_RUNTIME_MAX_BLOCKING_THREADS)
#io-runtime-max-blocking-threads="<N>"

# Max IO events per tick (env: INFLUXDB3_IO_RUNTIME_MAX_IO_EVENTS_PER_TICK)
#io-runtime-max-io-events-per-tick="<N>"

# IO runtime thread keep alive duration (env: INFLUXDB3_IO_RUNTIME_THREAD_KEEP_ALIVE)
#io-runtime-thread-keep-alive="<DURATION>"

# IO runtime thread priority (env: INFLUXDB3_IO_RUNTIME_THREAD_PRIORITY)
#io-runtime-thread-priority="<N>"

# =============================================================================
# Logging and Tracing
# =============================================================================

# Logs: destination
# Default: stdout (env: LOG_DESTINATION)
#log-destination="stdout"

# Logs: message format
# Default: full (env: LOG_FORMAT)
#log-format="full"

# Tracing: exporter type
# Default: none (env: TRACES_EXPORTER)
#traces-exporter="none"

# Jaeger agent hostname
# Default: 0.0.0.0 (env: TRACES_EXPORTER_JAEGER_AGENT_HOST)
#traces-exporter-jaeger-agent-host="0.0.0.0"

# Jaeger agent port
# Default: 6831 (env: TRACES_EXPORTER_JAEGER_AGENT_PORT)
#traces-exporter-jaeger-agent-port="6831"

# Jaeger service name
# Default: iox-conductor (env: TRACES_EXPORTER_JAEGER_SERVICE_NAME)
#traces-exporter-jaeger-service-name="iox-conductor"

# Header for trace context
# Default: uber-trace-id (env: TRACES_EXPORTER_JAEGER_TRACE_CONTEXT_HEADER_NAME)
#traces-exporter-jaeger-trace-context-header-name="uber-trace-id"

# Header for force sampling
# Default: jaeger-debug-id (env: TRACES_EXPORTER_JAEGER_DEBUG_NAME)
#traces-jaeger-debug-name="jaeger-debug-id"

# Key-value pairs for tracing spans (env: TRACES_EXPORTER_JAEGER_TAGS)
#traces-jaeger-tags="<TAGS>"

# Max messages per second
# Default: 1000 (env: TRACES_JAEGER_MAX_MSGS_PER_SECOND)
#traces-jaeger-max-msgs-per-second="1000"

# -----------------------------------------------------------------------------
# Tokio Console
# -----------------------------------------------------------------------------

# Enable tokio console for runtime debugging
# This comes with a certain runtime overhead
# Default: false (env: TOKIO_CONSOLE_ENABLED)
#tokio-console-enabled="false"

# Maximum capacity for the channel of events sent from subscriber layers to the
# aggregator task. When this channel is at capacity, additional events will be
# dropped. (env: TOKIO_CONSOLE_EVENT_BUFFER_CAPACITY)
#tokio-console-event-buffer-capacity="<SIZE>"

# Maximum capacity of updates to buffer for each subscribed client, if that
# client is not reading from the RPC stream. When this channel is at capacity,
# the client may be disconnected. (env: TOKIO_CONSOLE_CLIENT_BUFFER_CAPACITY)
#tokio-console-client-buffer-capacity="<SIZE>"
