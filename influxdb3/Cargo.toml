[package]
name = "influxdb3"
version.workspace = true
authors.workspace = true
edition.workspace = true
license.workspace = true
repository.workspace = true
description.workspace = true

[package.metadata.wix]
upgrade-guid = "8156E7ED-72AE-4A36-A0E0-3B5E68EAF61D"
path-guid = "32BA068C-517A-4FA1-8D87-906082ADD9E0"
license = false
eula = false

[dependencies]
# Core Crates
authz.workspace = true
clap_blocks.workspace = true
iox_query.workspace = true
iox_time.workspace = true
ioxd_common.workspace = true
metric.workspace = true
object_store.workspace = true
observability_deps.workspace = true
panic_logging.workspace = true
parquet_file.workspace = true
tokio_metrics_bridge.workspace = true
trace.workspace = true
trace_exporters.workspace = true
trogging.workspace = true

# Local Crates
influxdb3_client = { path = "../influxdb3_client" }
influxdb3_server = { path = "../influxdb3_server" }
influxdb3_write = { path = "../influxdb3_write" }

# Crates.io dependencies
backtrace.workspace = true
base64.workspace = true
clap.workspace = true
dotenvy.workspace = true
hex.workspace = true
libc.workspace = true
num_cpus.workspace = true
once_cell.workspace = true
parking_lot.workspace = true
rand.workspace = true
secrecy.workspace = true
sha2.workspace = true
thiserror.workspace = true
tokio.workspace = true
tokio-util.workspace = true
url.workspace = true
uuid.workspace = true

# Optional Dependencies
console-subscriber = { version = "0.1.10", optional = true, features = ["parking_lot"] }
tikv-jemalloc-ctl = { version = "0.5.4", optional = true }
tikv-jemalloc-sys = { version = "0.5.4", optional = true, features = ["unprefixed_malloc_on_supported_platforms"] }

[features]
default = ["jemalloc_replacing_malloc", "azure", "gcp", "aws"]
limits = []

azure = ["clap_blocks/azure"] # Optional Azure Object store support
gcp = ["clap_blocks/gcp"] # Optional GCP object store support
aws = ["clap_blocks/aws"] # Optional AWS / S3 object store support
pprof = ["ioxd_common/pprof"] # Optional http://localhost:8080/debug/pprof/profile support
heappy = ["ioxd_common/heappy"] # Optional http://localhost:8080/debug/pproc/alloc support

# Enable tokio_console support (https://github.com/tokio-rs/console)
#
# Requires enabling trace level tracing events for [tokio,runtime].
tokio_console = ["console-subscriber", "tokio/tracing", "observability_deps/release_max_level_trace"]

# heappy is an optional feature; Not on by default as it
# runtime overhead on all allocations (calls to malloc).
# Cargo cannot currently implement mutually exclusive features so let's force every build
# to pick either heappy or jemalloc_replacing_malloc feature at least until we figure out something better.
jemalloc_replacing_malloc = ["tikv-jemalloc-sys", "tikv-jemalloc-ctl"]

# Implicit feature selected when running under `clippy --all-features` to accept mutable exclusive features during
# linting
clippy = []

[dev-dependencies]
# Core Crates
arrow_util.workspace = true
influxdb_iox_client.workspace = true

# Crates.io dependencies in alphabetical order:
arrow.workspace = true
arrow-array.workspace = true
arrow-flight.workspace = true
assert_cmd.workspace = true
futures.workspace = true
hyper.workspace = true
pretty_assertions.workspace = true
reqwest.workspace = true
test_helpers.workspace = true
tonic.workspace = true
tower.workspace = true
